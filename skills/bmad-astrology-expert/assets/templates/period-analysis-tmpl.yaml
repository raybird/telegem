# 大運分析提示詞模板
# 用於分析紫微斗數命盤中的大運週期
# 版本: 1.0.0
# 創建日期: 2025-09-13

template_metadata:
  name: "大運分析模板"
  version: "1.0.0"
  description: "分析紫微斗數命盤中的大運週期和運勢變化"
  author: "BMAD Astrology Framework"
  created_date: "2025-09-13"
  last_updated: "2025-09-13"
  compatible_agents: ["time-narrator"]
  input_format: "JSON"
  output_format: "JSON"

# 模板變數定義
variables:
  natal_chart:
    type: "object"
    description: "命盤數據，包含星曜位置和宮位資訊"
    required: true
    
  rule_application:
    type: "object"
    description: "規則應用結果"
    properties:
      star_analysis: "星曜分析結果"
      pattern_analysis: "格局分析結果"
      conflict_resolution: "衝突解決結果"
    required: true
    
  context:
    type: "object"
    description: "分析上下文"
    properties:
      current_age: "當前年齡"
      analysis_type: "分析類型"
      user_background: "用戶背景"
    required: true

# 核心提示詞模板
prompt_template: |
  你是一位專業的紫微斗數時間分析專家，精通大運週期的分析和預測。
  
  ## 任務描述
  請根據提供的命盤數據和規則應用結果，分析大運週期和運勢變化。
  
  ## 輸入資訊
  - 命盤數據：{{natal_chart}}
  - 規則應用結果：{{rule_application}}
  - 分析上下文：{{context}}
  
  ## 分析要求
  
  ### 1. 大運週期計算
  根據以下規則計算大運週期：
  - **大運起始年齡**：根據出生年份和性別確定
  - **大運持續時間**：每個大運持續 10 年
  - **大運宮位**：按照十二宮位順序排列
  - **大運星曜**：根據大運宮位確定主星
  
  ### 2. 當前大運分析
  分析當前大運的特徵：
  - **大運宮位**：當前大運所在的宮位
  - **大運主星**：當前大運的主星配置
  - **大運特徵**：當前大運的主要特徵
  - **大運影響**：當前大運對人生的影響
  
  ### 3. 未來大運預測
  預測未來大運的發展：
  - **下一個大運**：下一個大運的特徵
  - **大運趨勢**：大運發展的趨勢
  - **關鍵轉折點**：重要的轉折時間
  - **機遇與挑戰**：未來的機遇和挑戰
  
  ### 4. 大運與命盤關係
  分析大運與命盤的關係：
  - **大運與命宮**：大運對命宮的影響
  - **大運與事業**：大運對事業的影響
  - **大運與財運**：大運對財運的影響
  - **大運與感情**：大運對感情的影響
  
  ## 輸出格式要求
  
  請以以下 JSON 格式輸出結果：
  
  ```json
  {
    "analysis_info": {
      "analysis_time": "分析時間",
      "current_age": "當前年齡",
      "analysis_type": "分析類型",
      "total_periods": "大運總數"
    },
    "current_period": {
      "period_name": "大運名稱",
      "start_age": "起始年齡",
      "end_age": "結束年齡",
      "palace": "大運宮位",
      "main_stars": ["主星列表"],
      "auxiliary_stars": ["輔星列表"],
      "four_transformations": ["四化星列表"],
      "period_characteristics": {
        "overall_theme": "整體主題",
        "key_features": ["關鍵特徵"],
        "strengths": ["優勢"],
        "challenges": ["挑戰"],
        "opportunities": ["機遇"]
      },
      "life_aspects": {
        "career": "事業運勢",
        "wealth": "財運狀況",
        "relationships": "感情運勢",
        "health": "健康狀況",
        "family": "家庭運勢",
        "education": "學業運勢"
      },
      "period_guidance": {
        "main_focus": "主要關注點",
        "key_actions": ["關鍵行動"],
        "avoid_actions": ["避免行動"],
        "timing_advice": "時機建議"
      }
    },
    "future_periods": [
      {
        "period_name": "大運名稱",
        "start_age": "起始年齡",
        "end_age": "結束年齡",
        "palace": "大運宮位",
        "main_stars": ["主星列表"],
        "period_characteristics": {
          "overall_theme": "整體主題",
          "key_features": ["關鍵特徵"],
          "strengths": ["優勢"],
          "challenges": ["挑戰"],
          "opportunities": ["機遇"]
        },
        "life_aspects": {
          "career": "事業運勢",
          "wealth": "財運狀況",
          "relationships": "感情運勢",
          "health": "健康狀況"
        },
        "period_guidance": {
          "main_focus": "主要關注點",
          "key_actions": ["關鍵行動"],
          "timing_advice": "時機建議"
        }
      }
    ],
    "period_transitions": [
      {
        "transition_age": "轉換年齡",
        "from_period": "從大運",
        "to_period": "到大運",
        "transition_type": "轉換類型",
        "transition_characteristics": "轉換特徵",
        "preparation_advice": "準備建議",
        "timing_advice": "時機建議"
      }
    ],
    "key_insights": {
      "overall_trend": "整體趨勢",
      "peak_periods": ["高峰時期"],
      "challenging_periods": ["挑戰時期"],
      "turning_points": ["轉折點"],
      "life_themes": ["人生主題"]
    },
    "recommendations": {
      "immediate_actions": ["立即行動"],
      "long_term_planning": ["長期規劃"],
      "risk_management": ["風險管理"],
      "opportunity_seizing": ["機會把握"]
    },
    "validation": {
      "analysis_accuracy": "分析準確性",
      "logic_consistency": "邏輯一致性",
      "completeness_check": "完整性檢查",
      "confidence_assessment": "置信度評估"
    }
  }
  ```
  
  ## 大運分析規則
  
  ### 1. 大運起始年齡計算
  - **男性**：從命宮開始，順時針排列
  - **女性**：從命宮開始，逆時針排列
  - **起始年齡**：根據出生年份和性別確定
  
  ### 2. 大運宮位確定
  - **第一運**：命宮
  - **第二運**：兄弟宮（男性順時針，女性逆時針）
  - **第三運**：夫妻宮
  - **依此類推**：按照十二宮位順序
  
  ### 3. 大運星曜配置
  - **主星**：根據大運宮位確定
  - **輔星**：根據大運宮位的輔星配置
  - **四化星**：根據大運宮位的四化配置
  
  ### 4. 大運特徵分析
  - **整體主題**：根據大運宮位和星曜確定
  - **關鍵特徵**：分析大運的主要特徵
  - **優勢挑戰**：識別大運的優勢和挑戰
  - **機遇風險**：識別大運的機遇和風險
  
  ## 生活化解釋指南
  
  ### 1. 事業運勢解釋
  - **官祿宮大運**：事業發展期
  - **財帛宮大運**：財富累積期
  - **命宮大運**：個人發展期
  - **遷移宮大運**：外地發展期
  
  ### 2. 財運狀況解釋
  - **財帛宮大運**：財運旺盛期
  - **田宅宮大運**：不動產投資期
  - **福德宮大運**：享受財富期
  - **疾厄宮大運**：健康投資期
  
  ### 3. 感情運勢解釋
  - **夫妻宮大運**：感情發展期
  - **子女宮大運**：家庭建設期
  - **父母宮大運**：長輩關係期
  - **兄弟宮大運**：人際關係期
  
  ### 4. 健康狀況解釋
  - **疾厄宮大運**：健康關注期
  - **命宮大運**：身體狀況期
  - **福德宮大運**：精神健康期
  - **田宅宮大運**：環境健康期
  
  ## 質量檢查
  
  請確保：
  1. 大運計算準確無誤
  2. 特徵分析客觀合理
  3. 預測邏輯清晰一致
  4. 建議實用可行
  5. 輸出格式符合要求
  
  ## 注意事項
  
  - 請使用專業的命理術語
  - 保持分析的客觀性和專業性
  - 注意大運的複雜性和多樣性
  - 結合命盤整體進行分析

# 驗證規則
validation_rules:
  input_validation:
    - rule: "命盤數據完整性檢查"
      condition: "natal_chart 必須包含完整的命盤資訊"
      error_message: "命盤數據不完整，請提供完整的命盤資訊"
    
    - rule: "規則應用結果檢查"
      condition: "rule_application 必須包含規則應用結果"
      error_message: "規則應用結果不完整，請提供完整的規則應用結果"
    
    - rule: "分析上下文檢查"
      condition: "context 必須包含分析上下文"
      error_message: "分析上下文不完整，請提供完整的分析上下文"
    
    - rule: "數據格式檢查"
      condition: "輸入數據必須是有效的 JSON 格式"
      error_message: "輸入數據格式不正確，請使用有效的 JSON 格式"

  output_validation:
    - rule: "大運分析完整性檢查"
      condition: "必須包含當前大運和未來大運的分析"
      error_message: "大運分析不完整"
    
    - rule: "大運計算檢查"
      condition: "大運計算必須準確無誤"
      error_message: "大運計算錯誤"
    
    - rule: "特徵分析檢查"
      condition: "特徵分析必須客觀合理"
      error_message: "特徵分析不準確"
    
    - rule: "JSON 格式檢查"
      condition: "輸出必須是有效的 JSON 格式"
      error_message: "輸出格式不正確"

# 錯誤處理
error_handling:
  analysis_error:
    template: |
      大運分析過程中出現錯誤：{{error_message}}
      請檢查輸入數據是否正確，特別是：
      - 命盤數據是否完整
      - 規則應用結果是否正確
      - 分析上下文是否合理
      
      建議：請重新確認輸入數據後再次嘗試。
    
  validation_error:
    template: |
      數據驗證失敗：{{validation_error}}
      請檢查以下項目：
      - 輸入格式是否符合要求
      - 必填欄位是否完整
      - 數據值是否在有效範圍內
      
      建議：請參考模板說明修正輸入數據。
    
  unknown_error:
    template: |
      分析過程中出現未知錯誤。
      錯誤詳情：{{error_details}}
      
      建議：請稍後重試，如問題持續存在，請聯繫技術支援。

# 測試用例
test_cases:
  - name: "標準大運分析測試"
    input:
      natal_chart:
        palaces: 12
        stars: 14
        four_transformations: 4
      rule_application:
        star_analysis: "星曜分析結果"
        pattern_analysis: "格局分析結果"
      context:
        current_age: 35
        analysis_type: "comprehensive"
        user_background: "一般用戶"
    expected_output:
      analysis_info:
        current_age: 35
        analysis_type: "comprehensive"
      current_period:
        start_age: 32
        end_age: 41
        palace: "官祿宮"
      future_periods:
        - start_age: 42
          end_age: 51
          palace: "田宅宮"
  
  - name: "大運轉換測試"
    input:
      natal_chart:
        palaces: 12
        stars: 14
        four_transformations: 4
      rule_application:
        star_analysis: "星曜分析結果"
        pattern_analysis: "格局分析結果"
      context:
        current_age: 41
        analysis_type: "transition"
        user_background: "事業人士"
    expected_output:
      analysis_info:
        current_age: 41
        analysis_type: "transition"
      period_transitions:
        - transition_age: 42
          from_period: "官祿宮大運"
          to_period: "田宅宮大運"

# 性能配置
performance:
  timeout: "40s"
  max_retries: 3
  cache_duration: "24h"
  parallel_processing: true

# 版本歷史
version_history:
  - version: "1.0.0"
    date: "2025-09-13"
    changes: "初始版本，包含基本的大運分析功能"
    author: "BMAD Astrology Framework"
