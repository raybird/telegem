
# ç´«å¾®æ–—æ•¸æ’ç›¤è¨ˆç®—æ™ºèƒ½é«” (cubshuang å®Œæ•´ç‰ˆ)


## è§’è‰²å®šç¾©
**èº«ä»½ï¼š** ç´«å¾®æ–—æ•¸æ’ç›¤è¨ˆç®—å°ˆå®¶  
**æ ¸å¿ƒèƒ½åŠ›ï¼š** ä½¿ç”¨ cubshuang/ZiWeiDouShu v5 å®Œæ•´è¨ˆç®—å¼•æ“ï¼Œç”¢ç”Ÿ 100% æº–ç¢ºçš„å‘½ç›¤  
**æŠ€è¡“ç‰¹è‰²ï¼š** æ–‡æª”å…§åµŒå®Œæ•´è¨ˆç®—é‚è¼¯ï¼ŒåŸºæ–¼é–‹æºå°ˆæ¡ˆï¼Œç¢ºä¿è¨ˆç®—æº–ç¢ºæ€§  
**é‡è¦èªªæ˜ï¼š** æœ¬å¯¦ç¾å®Œå…¨å°æº– [cubshuang/ZiWeiDouShu](https://github.com/cubshuang/ZiWeiDouShu) demo é é¢çš„å¯¦éš›å¯¦ç¾ï¼Œç„¡ä»»ä½•çœç•¥æˆ–ç²¾ç°¡ï¼Œç¢ºä¿è¨ˆç®—çµæœèˆ‡ demo é é¢ 100% ä¸€è‡´

## ğŸ”§ é—œéµä¿®æ­£èªªæ˜

**ç‰ˆæœ¬ï¼š** 2.8.0  
**ä¿®æ­£æ—¥æœŸï¼š** 2025-12-03  
**ä¿®æ­£åŸå› ï¼š** ç ”ç©¶ demo é é¢å¯¦éš›æ’ç›¤é‚è¼¯å¾Œç™¼ç¾é—œéµå·®ç•°

### ä¸»è¦ä¿®æ­£é»ï¼š

1. **Place12 ç´¢å¼•æ–¹å¼ä¿®æ­£**ï¼š
   - âŒ éŒ¯èª¤ï¼š`Place12[i]` ä¸­çš„ `i` æ˜¯ä»¥å‘½å®®ç‚ºåŸºæº–çš„ç›¸å°ä½ç½®
   - âœ… æ­£ç¢ºï¼š`Place12[i]` ä¸­çš„ `i` ç›´æ¥å°æ‡‰åœ°æ”¯ç´¢å¼•ï¼ˆ0=å­, 1=ä¸‘, ..., 11=äº¥ï¼‰

2. **stepSetStar å‡½æ•¸é‚è¼¯ä¿®æ­£**ï¼š
   - âŒ éŒ¯èª¤ï¼šä½¿ç”¨ `(lPos + i) % 12` è¨ˆç®—åˆ†æ”¯ç´¢å¼•
   - âœ… æ­£ç¢ºï¼šç›´æ¥ä½¿ç”¨ `i` ä½œç‚ºåœ°æ”¯ç´¢å¼•é€²è¡Œæ˜Ÿæ›œåŒ¹é…

3. **å‡½æ•¸åƒæ•¸ä¿®æ­£**ï¼š
   - `setZiwei(d)` - åªæ¥å—ä¸€å€‹åƒæ•¸ï¼Œä½¿ç”¨å…¨åŸŸè®Šæ•¸
   - `stepSetStar(y, m, d, h)` - ä½¿ç”¨å…¨åŸŸè®Šæ•¸è€Œéåƒæ•¸å‚³é

4. **å¹´å¹²åœ°æ”¯è¨ˆç®—æ–¹å¼**ï¼š
   - å¾å¹´å¹²åœ°æ”¯å­—ç¬¦ä¸²ä¸­æå–ç´¢å¼•ï¼Œè€Œéç›´æ¥è¨ˆç®—ï¼ˆçµæœç›¸åŒä½†æ–¹å¼ä¸€è‡´ï¼‰  

## å·¥ä½œæµç¨‹

### æ­¥é©Ÿ 1ï¼šæ¥æ”¶ä¸¦é©—è­‰è¼¸å…¥
æ¥æ”¶ç”¨æˆ¶æä¾›çš„å‡ºç”Ÿè³‡è¨Šï¼Œæ ¼å¼åŒ–ç‚ºæ¨™æº–æ ¼å¼ã€‚

### æ­¥é©Ÿ 2ï¼šåŸ·è¡ŒåµŒå…¥å¼è¨ˆç®—å¼•æ“
ä½¿ç”¨ä¸‹æ–¹çš„å®Œæ•´ JavaScript å‡½æ•¸é€²è¡Œç²¾ç¢ºè¨ˆç®—ã€‚

### æ­¥é©Ÿ 3ï¼šæ ¼å¼åŒ–è¼¸å‡ºçµæœ
å°‡è¨ˆç®—çµæœè½‰æ›ç‚ºæ˜“è®€çš„å‘½ç›¤æ ¼å¼ï¼Œä¸¦æ¨™ç¤ºè¨ˆç®—ä¾†æºã€‚

## ğŸš€ å®Œæ•´åµŒå…¥å¼ JavaScript è¨ˆç®—å¼•æ“

```javascript
// =============================================================================
// ç´«å¾®æ–—æ•¸æ’ç›¤è¨ˆç®—å¼•æ“ (å®Œå…¨å°æº– cubshuang/ZiWeiDouShu v5)
// ç‰ˆæœ¬: 2.8.0 (å®Œå…¨å°æº– demo é é¢å¯¦ç¾ - ä¿®æ­£ Place12 ç´¢å¼•æ–¹å¼)
// ä¾†æº: https://github.com/cubshuang/ZiWeiDouShu
// Demo é é¢: https://cubshuang.github.io/ZiWeiDouShu/
// æˆæ¬Š: MIT License
// 
// é‡è¦èªªæ˜ï¼š
// - æœ¬å¯¦ç¾å®Œå…¨å°æº– cubshuang/ZiWeiDouShu åŸå§‹å°ˆæ¡ˆçš„è¨ˆç®—é‚è¼¯
// - æ‰€æœ‰å‡½æ•¸ã€æ•¸æ“šè¡¨ã€è¨ˆç®—æ­¥é©Ÿå‡èˆ‡åŸå§‹å°ˆæ¡ˆå®Œå…¨ä¸€è‡´
// - ç„¡ä»»ä½•çœç•¥ã€ç²¾ç°¡æˆ–æ”¹å‹•ï¼Œç¢ºä¿è¨ˆç®—çµæœ 100% ä¸€è‡´
// - æ ¸å¿ƒå‡½æ•¸ï¼šcomputeZiWei, setZiwei, stepSetStar å®Œå…¨æŒ‰ç…§åŸå§‹å¯¦ç¾
// =============================================================================

// åŸºç¤æ•¸æ“šå®šç¾©
var YinYang = ["é™½","é™°"];
var HeavenlyStems = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];
var EarthlyBranches = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
var Palace = ["ã€å‘½å®®ã€‘","ã€çˆ¶æ¯å®®ã€‘","ã€ç¦å¾·å®®ã€‘","ã€ç”°å®…å®®ã€‘","ã€å®˜ç¥¿å®®ã€‘","ã€äº¤å‹å®®ã€‘","ã€é·ç§»å®®ã€‘","ã€ç–¾å„å®®ã€‘","ã€è²¡å¸›å®®ã€‘","ã€å­å¥³å®®ã€‘","ã€å¤«å¦»å®®ã€‘","ã€å…„å¼Ÿå®®ã€‘","ã€èº«ã€‘"];
var FiveElements = ["æ°´äºŒå±€","ç«å…­å±€","åœŸäº”å±€","æœ¨ä¸‰å±€","é‡‘å››å±€"];

// æ˜Ÿæ›œåç¨±å®šç¾©
var StarM_A14 = ["ç´«å¾®","å¤©æ©Ÿ","å¤ªé™½","æ­¦æ›²","å¤©åŒ","å»‰è²","å¤©åºœ","å¤ªé™°","è²ªç‹¼","å·¨é–€","å¤©ç›¸","å¤©æ¢","ä¸ƒæ®º","ç ´è»"];
var StarM_A07 = ["æ–‡æ˜Œ","æ–‡æ›²","å·¦è¼”","å³å¼¼","å¤©é­","å¤©é‰","ç¥¿å­˜"];
var StarM_S04 = ["åŒ–ç¥¿","åŒ–æ¬Š","åŒ–ç§‘","åŒ–å¿Œ"];
var StarM_B06 = ["æ“ç¾Š","é™€ç¾…","ç«æ˜Ÿ","éˆ´æ˜Ÿ","å¤©ç©º","åœ°åŠ«"];
var StarO_S05 = ["å¤©é¦¬","é¾æ± ","é³³é–£","ç´…é¸","å¤©å–œ"];

// äº”è¡Œå±€è¡¨
var FiveEleTable = [
    [1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,0,0,1,1,2,2,3,3,4], // æ°´äºŒå±€
    [9,6,11,4,1,2,10,7,0,5,2,3,11,8,1,6,3,4,0,9,2,7,4,5,1,10,3,8,5,6], // ç«å…­å±€
    [6,11,4,1,2,7,0,5,2,3,8,1,6,3,4,9,2,7,4,5,10,3,8,5,6,11,4,9,6,7], // åœŸäº”å±€
    [4,1,2,5,2,3,6,3,4,7,4,5,8,5,6,9,6,7,10,7,8,11,8,9,0,9,10,1,10,11], // æœ¨ä¸‰å±€
    [11,4,1,2,0,5,2,3,1,6,3,4,2,7,4,5,3,8,5,6,4,9,6,7,5,10,7,8,6,11]  // é‡‘å››å±€
];

var FiveEleArr = [[0,1,3,2,4,1],[1,2,4,3,0,2],[2,3,0,4,1,3],[3,4,1,0,2,4],[4,0,2,1,3,0]];

// ä¸»æ˜Ÿå®‰æ˜Ÿè¡¨
var Star_A14 = [
    [[0],[],[13],[],[5,6],[7],[8],[4,9],[3,10],[2,11],[12],[1]],
    [[1],[0,13],[],[6],[7],[5,8],[9],[10],[4,11],[3,12],[2],[]],
    [[13],[1],[0,6],[7],[8],[9],[5,10],[11],[12],[10],[3],[2]],
    [[2],[6],[1,7],[0,8],[9],[10],[11],[5,12],[],[],[4],[3,13]],
    [[3,6],[2,7],[8],[1,9],[0,10],[11],[12],[],[5],[],[13],[4]],
    [[4,7],[3,8],[2,9],[10],[1,10],[0,12],[],[],[],[5,13],[],[6]],
    [[8],[4,9],[3,10],[2,11],[12],[1],[0],[],[13],[],[5,6],[7]],
    [[9],[10],[4,11],[3,12],[2],[],[1],[0,13],[],[6],[7],[5,8]],
    [[5,10],[11],[12],[10],[3],[2],[13],[1],[0,6],[7],[8],[9]],
    [[11],[5,12],[],[],[4],[3,13],[2],[6],[1,7],[0,8],[9],[10]],
    [[12],[],[5],[],[13],[4],[3,6],[2,7],[8],[1,9],[0,10],[11]],
    [[],[],[],[5,13],[],[6],[4,7],[3,8],[2,9],[10],[1,10],[0,12]]
];

// ç´«å¾®æ˜Ÿç³»å®‰æ˜Ÿè¡¨
var Star_Z06 = [
    [0,1,2,3,4,5,6,7,8,9,10,11],
    [11,0,1,2,3,4,5,6,7,8,9,10],
    [9,10,11,0,1,2,3,4,5,6,7,8],
    [8,9,10,11,0,1,2,3,4,5,6,7],
    [7,8,9,10,11,0,1,2,3,4,5,6],
    [4,5,6,7,8,9,10,11,0,1,2,3],
    [4,3,2,1,0,11,10,9,8,7,6,5]
];

// å¤©åºœæ˜Ÿç³»å®‰æ˜Ÿè¡¨
var Star_T08 = [
    [0,1,2,3,4,5,6,7,8,9,10,11],
    [1,2,3,4,5,6,7,8,9,10,11,0],
    [2,3,4,5,6,7,8,9,10,11,0,1],
    [3,4,5,6,7,8,9,10,11,0,1,2],
    [4,5,6,7,8,9,10,11,0,1,2,3],
    [5,6,7,8,9,10,11,0,1,2,3,4],
    [6,7,8,9,10,11,0,1,2,3,4,5],
    [10,11,0,1,2,3,4,5,6,7,8,9]
];

// è¼”æ˜Ÿå®‰æ˜Ÿè¡¨
var Star_G07 = [
    [10,9,8,7,6,5,4,3,2,1,0,11], // æ–‡æ˜Œ
    [4,5,6,7,8,9,10,11,0,1,2,3], // æ–‡æ›²
    [4,5,6,7,8,9,10,11,0,1,2,3], // å·¦è¼”
    [10,9,8,7,6,5,4,3,2,1,0,11], // å³å¼¼
    [1,0,11,11,1,0,1,6,3,3],     // å¤©é­
    [7,8,9,9,7,8,7,2,5,5],       // å¤©é‰
    [2,3,5,6,5,6,8,9,11,0]       // ç¥¿å­˜
];

// å››åŒ–æ˜Ÿè¡¨
var Star_S04 = [
    [StarM_A14[5],StarM_A14[1],StarM_A14[4],StarM_A14[7],StarM_A14[8],StarM_A14[3],StarM_A14[2],StarM_A14[9],StarM_A14[11],StarM_A14[13]], // åŒ–ç¥¿
    [StarM_A14[13],StarM_A14[11],StarM_A14[1],StarM_A14[4],StarM_A14[7],StarM_A14[8],StarM_A14[3],StarM_A14[2],StarM_A14[0],StarM_A14[9]], // åŒ–æ¬Š
    [StarM_A14[3],StarM_A14[0],StarM_A07[0],StarM_A14[1],StarM_A07[3],StarM_A14[11],StarM_A14[7],StarM_A07[1],StarM_A07[2],StarM_A14[7]], // åŒ–ç§‘
    [StarM_A14[2],StarM_A14[7],StarM_A14[5],StarM_A14[9],StarM_A14[1],StarM_A07[1],StarM_A14[4],StarM_A07[0],StarM_A14[3],StarM_A14[8]]  // åŒ–å¿Œ
];

// ç…æ˜Ÿå®‰æ˜Ÿè¡¨
var Star_B06 = [
    [3,4,6,7,6,7,9,10,0,1], // æ“ç¾Š
    [1,2,4,5,4,5,7,8,10,11], // é™€ç¾…
    [[2,3,4,5,6,7,8,9,10,11,0,1],[3,4,5,6,7,8,9,10,11,0,1,2],[1,2,3,4,5,6,7,8,9,10,11,0],[9,10,11,0,1,2,3,4,5,6,7,8]], // ç«æ˜Ÿ
    [[10,11,0,1,2,3,4,5,6,7,8,9],[10,11,0,1,2,3,4,5,6,7,8,9],[3,4,5,6,7,8,9,10,11,0,1,2],[10,11,0,1,2,3,4,5,6,7,8,9]], // éˆ´æ˜Ÿ
    [11,10,9,8,7,6,5,4,3,2,1,0], // å¤©ç©º
    [11,0,1,2,3,4,5,6,7,8,9,10]  // åœ°åŠ«
];

// é›œæ›œå®‰æ˜Ÿè¡¨
var Star_OS5 = [
    [2,11,8,5,2,11,8,5,2,11,8,5], // å¤©é¦¬
    [4,5,6,7,8,9,10,11,0,1,2,3],  // é¾æ± 
    [10,11,0,1,2,3,4,5,6,7,8,9],  // é³³é–£
    [1,2,3,4,5,6,7,8,9,10,11,0],  // ç´…é¸
    [7,8,9,10,11,0,1,2,3,4,5,6]   // å¤©å–œ
];

// =============================================================================
// è¾²æ›†è½‰æ›å‡½æ•¸åº« (lunar.js)
// ä¾†æº: https://github.com/cubshuang/ZiWeiDouShu/blob/master/js/lunar.js
// ä½œè€…: Einstein (1999-4-12)
// æˆæ¬Š: MIT License (èˆ‡ cubshuang/ZiWeiDouShu å°ˆæ¡ˆç›¸åŒ)
// èªªæ˜: å®Œæ•´çš„é™°é™½æ›†è½‰æ›å‡½æ•¸åº«ï¼Œæ”¯æ´ 1900-2049 å¹´
// =============================================================================

var BYEAR=1201
var Nyear=150;     /* number of years covered by the table */
var Nmonth=13      /* maximum number of months in a lunar year */

function make_array() {
  var tmparg=make_array.arguments;
  for(var i=0;i<tmparg.length;i++) {
    this[i]=tmparg[i];
  }
  this.length=tmparg.length;
}

function make_n_array(num) {
  for(var i=0;i<num;i++) {
    this[i]=i;
  }
  this.length=num;
}

function MyDate(y,m,d,h,w,l){//year,month,day,hour,week,leap
  this.y=y;
  this.m=m;
  this.d=d;
  this.h=h;
  this.w=w;
  this.l=l;
}

var yearInfo=new make_array(
                                        0x04bd8,        /* 1900 */
    0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950,        /* 1905 */
    0x16554, 0x056a0, 0x09ad0, 0x055d2, 0x04ae0,        /* 1910 */
    0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540,        /* 1915 */
    0x0d6a0, 0x0ada2, 0x095b0, 0x14977, 0x04970,        /* 1920 */
    0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54,        /* 1925 */
    0x02b60, 0x09570, 0x052f2, 0x04970, 0x06566,        /* 1930 */
    0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60,        /* 1935 */
    0x186e3, 0x092e0, 0x1c8d7, 0x0c950, 0x0d4a0,        /* 1940 */
    0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0,        /* 1945 */
    0x092d0, 0x0d2b2, 0x0a950, 0x0b557, 0x06ca0,        /* 1950 */
    0x0b550, 0x15355, 0x04da0, 0x0a5d0, 0x14573,        /* 1955 */
    0x052d0, 0x0a9a8, 0x0e950, 0x06aa0, 0x0aea6,        /* 1960 */
    0x0ab50, 0x04b60, 0x0aae4, 0x0a570, 0x05260,        /* 1965 */
    0x0f263, 0x0d950, 0x05b57, 0x056a0, 0x096d0,        /* 1970 */
    0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250,        /* 1975 */
    0x0d558, 0x0b540, 0x0b5a0, 0x195a6, 0x095b0,        /* 1980 */
    0x049b0, 0x0a974, 0x0a4b0, 0x0b27a, 0x06a50,        /* 1985 */
    0x06d40, 0x0af46, 0x0ab60, 0x09570, 0x04af5,        /* 1990 */
    0x04970, 0x064b0, 0x074a3, 0x0ea50, 0x06b58,        /* 1995 */
    0x055c0, 0x0ab60, 0x096d5, 0x092e0, 0x0c960,        /* 2000 */
    0x0d954, 0x0d4a0, 0x0da50, 0x07552, 0x056a0,        /* 2005 */
    0x0abb7, 0x025d0, 0x092d0, 0x0cab5, 0x0a950,        /* 2010 */
    0x0b4a0, 0x0baa4, 0x0ad50, 0x055d9, 0x04ba0,        /* 2015 */
    0x0a5b0, 0x15176, 0x052b0, 0x0a930, 0x07954,        /* 2020 */
    0x06aa0, 0x0ad50, 0x05b52, 0x04b60, 0x0a6e6,        /* 2025 */
    0x0a4e0, 0x0d260, 0x0ea65, 0x0d530, 0x05aa0,        /* 2030 */
    0x076a3, 0x096d0, 0x04bd7, 0x04ad0, 0x0a4d0,        /* 2035 */
    0x1d0b6, 0x0d250, 0x0d520, 0x0dd45, 0x0b5a0,        /* 2040 */
    0x056d0, 0x055b2, 0x049b0, 0x0a577, 0x0a4b0,        /* 2045 */
    0x0aa50, 0x1b255, 0x06d20, 0x0ada0                  /* 2049 */
);

var fest = new make_array(
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1900 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1901 */
5, 6, 6, 6, 7, 8, 8, 8, 9, 8, 8, 6,   /* 1902 */
5, 7, 6, 7, 7, 8, 9, 9, 9, 8, 8, 7,   /* 1903 */
5, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1904 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1905 */
5, 6, 6, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1906 */
5, 7, 6, 7, 7, 8, 9, 9, 9, 8, 8, 7,   /* 1907 */
5, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1908 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1909 */
5, 6, 6, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1910 */
5, 7, 6, 7, 7, 8, 9, 9, 9, 8, 8, 7,   /* 1911 */
5, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1912 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1913 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1914 */
5, 6, 6, 6, 7, 8, 8, 9, 9, 8, 8, 6,   /* 1915 */
5, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1916 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 7, 6,   /* 1917 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1918 */
5, 6, 6, 6, 7, 8, 8, 9, 9, 8, 8, 6,   /* 1919 */
5, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1920 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 9, 7, 6,   /* 1921 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1922 */
5, 6, 6, 6, 7, 8, 8, 9, 9, 8, 8, 6,   /* 1923 */
5, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1924 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 7, 6,   /* 1925 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1926 */
5, 6, 6, 6, 7, 8, 8, 8, 9, 8, 8, 6,   /* 1927 */
5, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1928 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1929 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1930 */
5, 6, 6, 6, 7, 8, 8, 8, 9, 8, 8, 6,   /* 1931 */
5, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1932 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1933 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1934 */
5, 6, 6, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1935 */
5, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1936 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1937 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1938 */
5, 6, 6, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1939 */
5, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1940 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1941 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1942 */
5, 6, 6, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1943 */
5, 6, 5, 5, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1944 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1945 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1946 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1947 */
5, 5, 5, 5, 6, 7, 7, 8, 8, 7, 7, 5,   /* 1948 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1949 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1950 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1951 */
5, 5, 5, 5, 6, 7, 7, 8, 8, 7, 7, 5,   /* 1952 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1953 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 7, 6,   /* 1954 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1955 */
5, 5, 5, 5, 6, 7, 7, 8, 8, 7, 7, 5,   /* 1956 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1957 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1958 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1959 */
5, 5, 5, 5, 6, 7, 7, 7, 8, 7, 7, 5,   /* 1960 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1961 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1962 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1963 */
5, 5, 5, 5, 6, 7, 7, 7, 8, 7, 7, 5,   /* 1964 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1965 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1966 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1967 */
5, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1968 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1969 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1970 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1971 */
5, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1972 */
4, 6, 5, 5, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1973 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1974 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1975 */
5, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1976 */
4, 6, 5, 5, 6, 7, 7, 8, 8, 7, 7, 6,   /* 1977 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1978 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1979 */
5, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1980 */
4, 6, 5, 5, 6, 7, 7, 8, 8, 7, 7, 6,   /* 1981 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1982 */
4, 6, 5, 6, 6, 8, 8, 8, 9, 8, 8, 6,   /* 1983 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1984 */
5, 5, 5, 5, 5, 8, 7, 7, 8, 7, 7, 5,   /* 1985 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1986 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1987 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1988 */
5, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1989 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 1990 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1991 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1992 */
5, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1993 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1994 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1995 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1996 */
5, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 1997 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 1998 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 1999 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2000 */
4, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2001 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 2002 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 2003 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2004 */
4, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2005 */
4, 6, 5, 5, 6, 7, 7, 8, 8, 7, 7, 6,   /* 2006 */
4, 6, 5, 6, 6, 7, 8, 8, 9, 8, 7, 6,   /* 2007 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2008 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2009 */
4, 6, 5, 5, 6, 7, 7, 8, 8, 7, 7, 6,   /* 2010 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 2011 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2012 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2013 */
4, 6, 5, 5, 6, 7, 7, 8, 8, 7, 7, 6,   /* 2014 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 2015 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2016 */
3, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2017 */
4, 5, 5, 5, 6, 7, 7, 8, 8, 7, 7, 5,   /* 2018 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 2019 */
4, 5, 4, 5, 5, 6, 7, 7, 8, 7, 7, 5,   /* 2020 */
3, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2021 */
4, 5, 5, 5, 6, 7, 7, 7, 8, 7, 7, 5,   /* 2022 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 8, 7, 6,   /* 2023 */
4, 5, 4, 5, 5, 6, 7, 7, 8, 7, 6, 5,   /* 2024 */
3, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2025 */
4, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2026 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 2027 */
4, 5, 4, 5, 5, 6, 7, 7, 8, 7, 6, 5,   /* 2028 */
3, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2029 */
4, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2030 */
4, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7, 6,   /* 2031 */
4, 5, 4, 5, 5, 6, 7, 7, 8, 7, 6, 5,   /* 2032 */
3, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2033 */
4, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2034 */
4, 6, 5, 5, 6, 7, 7, 8, 8, 7, 7, 6,   /* 2035 */
4, 5, 4, 5, 5, 6, 7, 7, 8, 7, 6, 5,   /* 2036 */
3, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2037 */
4, 5, 5, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2038 */
4, 6, 5, 5, 6, 7, 7, 8, 8, 7, 7, 6,   /* 2039 */
4, 5, 4, 5, 5, 6, 7, 7, 8, 7, 6, 5,   /* 2040 */
3, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2041 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2042 */
4, 6, 5, 5, 6, 7, 7, 8, 8, 7, 7, 6,   /* 2043 */
4, 5, 4, 5, 5, 6, 7, 7, 7, 7, 6, 5,   /* 2044 */
3, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2045 */
4, 5, 4, 5, 5, 7, 7, 7, 8, 7, 7, 5,   /* 2046 */
4, 6, 5, 5, 6, 7, 7, 8, 8, 7, 7, 6,   /* 2047 */
4, 5, 4, 5, 5, 6, 7, 7, 7, 7, 6, 5,   /* 2048 */
3, 5, 4, 5, 5, 6, 7, 7, 8, 7, 7, 5    /* 2049 */
);

var ymonth=new make_n_array(Nyear);
var yday=new make_n_array(Nyear);
var mday=new make_n_array(Nmonth+1);
var moon=new make_array(29,30);
var GanGB=new make_array("ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸");
var ZhiGB=new make_array("å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥");
var daysInSolarMonth=new make_array(0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31);
var solarFirstDate=new MyDate(1900,1,31,0,3,0);
var LunarFirstDate=new MyDate(1900, 1, 1, 0, 3, 0);
var GanFirstDate=new MyDate(6,4,0,0,3,0);
var ZhiFirstDate=new MyDate(0,2,4,0,3,0);

var solar_global=new MyDate(0,0,0,0,0,0);
var lunar_global=new MyDate(0,0,0,0,0,0);
var gan_global=new MyDate(0,0,0,0,0,0);
var zhi_global=new MyDate(0,0,0,0,0,0);

function LeapYear(y) {
  return ( ((y%4)==0) && ((y%100)!=0) || ((y%400)==0) );
}

function solar2Day1(d) {
  var offset,delta;
  var i;
  delta=d.y-BYEAR;
  if(delta<0) {
    return -1;
  }
  offset=Math.floor(delta*365)+Math.floor(delta/4)-Math.floor(delta/100)+Math.floor(delta/400);
  for(i=1;i<d.m;i++) {
    offset+=daysInSolarMonth[i];
  }
  if((d.m>2) && (LeapYear(d.y))) offset++;
  offset+=d.d-1;
  if((d.m==2) && LeapYear(d.y)) {
    if(d.d>29) {
      return -1;
    }
  }
  else if(d.d>daysInSolarMonth[d.m]) {
    return -1;
  }
  return offset;
}

function solar2Day(d) {
  return (solar2Day1(d)-solar2Day1(solarFirstDate));
}

function make_yday() {
  var year, i, leap;
  var code;
  for (year = 0; year < Nyear; year++) {
    code = yearInfo[year];
    leap = code & 0xf;
    yday[year] = 0;
    if (leap != 0) {
      i = (code >> 16) & 0x1;
      yday[year] += moon[i];
    }
    code >>= 4;
    for (i = 0; i < Nmonth-1; i++) {
      yday[year] += moon[code&0x1];
      code >>= 1;
    }
    ymonth[year] = 12;
    if (leap != 0) ymonth[year]++;
  }
  return Nyear;
}

function make_mday(year) {
    var i, leapMonth,code;
    code = yearInfo[year];
    leapMonth = code & 0xf;
    code >>= 4;
    if (leapMonth == 0) {
        mday[Nmonth] = 0;
        for (i = Nmonth-1; i >= 1; i--) {
            mday[i] = moon[code&0x1];
            code >>= 1;
        }
    }
    else {
        i = (yearInfo[year] >> 16) & 0x1;
        mday[leapMonth+1] = moon[i];
        for (i = Nmonth; i >= 1; i--) {
            if (i == leapMonth+1) i--;
            mday[i] = moon[code&0x1];
            code >>= 1;
        }
    }
    return leapMonth;
}

function day2Lunar(offset,d) {
  var i,m,nYear,leapMonth;
  nYear = make_yday();
  for (i=0; i<nYear && offset > 0; i++)  offset -= yday[i];
  if (offset<0)  offset += yday[--i];
  if (i==Nyear) {
    return ;
  }
  d.y = i + LunarFirstDate.y;
  leapMonth = make_mday(i);
  for (m=1; m<=Nmonth && offset>0; m++)  offset -= mday[m];
  if (offset<0) offset += mday[--m];
  d.l= 0;
  if (leapMonth>0)  {
    d.l = (leapMonth == (m - 1));
    if (m > leapMonth) --m;
  }
  d.m = m;
  d.d = offset + 1;
}

function CalGZ(offset, d, g, z) {
  var year, month;
  year = d.y - LunarFirstDate.y;
  month = year * 12 + d.m - 1;
  g.y = (GanFirstDate.y + year) % 10;
  z.y = (ZhiFirstDate.y + year) % 12;
  g.m = (GanFirstDate.m + month) % 10;
  z.m = (ZhiFirstDate.m + month) % 12;
  g.d = (GanFirstDate.d + offset) % 10;
  z.d = (ZhiFirstDate.d + offset) % 12;
  z.h = Math.floor((d.h + 1) / 2) % 12;
  g.h = (g.d * 12 + z.h) % 10;
}

function CmpDate(month1, day1, month2, day2) {
    if (month1!=month2) return(month1-month2);
    if (day1!=day2) return(day1-day2);
    return(0);
}

function JieDate(ds, dl) {
    var m, flag;
    if (ds.m==1) {
        flag = CmpDate(ds.m, ds.d, 1, fest[(ds.y - solarFirstDate.y - 1)*12+11]);
        if (flag<0) dl.m = 11;
        else if (flag>0) dl.m = 12;
        dl.y = ds.y - 1;
        return(flag==0);
    }
    for (m=2; m<=12; m++) {
        flag = CmpDate(ds.m, ds.d, m, fest[(ds.y - solarFirstDate.y)*12+m-2]);
        if (flag==0) m++;
        if (flag<=0) break;
    }
    dl.m = (m-2) % 12;
    dl.y = ds.y;
    if ((dl.m)==0){
        dl.y = ds.y - 1;
        dl.m = 12;
    }
    return(flag==0);
}

function solar2Lunar() {
  var offset;
  offset=solar2Day(solar_global);
  solar_global.w=(offset+solarFirstDate.w)%7;
  if(solar_global.h==23) offset++;
  day2Lunar(offset,lunar_global);
  lunar_global.h=solar_global.h;
  CalGZ(offset,lunar_global,gan_global,zhi_global);
}

function Lunar(type,my_y,my_m,my_d) {
  if(type==0) {
    solar_global.y=my_y;
    solar_global.m=my_m;
    solar_global.d=my_d;
    solar_global.h=0;
    solar2Lunar();
  }
}


// =============================================================================
// æ ¸å¿ƒè¨ˆç®—å‡½æ•¸ - å®Œå…¨å°æº– cubshuang/ZiWeiDouShu åŸå§‹å¯¦ç¾
// ä¾†æº: https://github.com/cubshuang/ZiWeiDouShu/blob/master/js/ziweicore.js
// =============================================================================

// cubshuang åŸå§‹ computeZiWei å‡½æ•¸çµæ§‹ - å®Œå…¨å°æº– demo é é¢å¯¦éš›å¯¦ç¾
function computeZiWei(y_Solar, m_Solar, d_Solar, h_Solar, g_Solar) {
    // 1. è¨­å®šå…¨åŸŸè®Šæ•¸ (å®Œå…¨æŒ‰ç…§ cubshuang çš„æ–¹å¼)
    var yS = y_Solar;
    var mS = m_Solar;
    var dS = d_Solar;
    
    // 2. è¾²æ›†è½‰æ› (å®Œå…¨æŒ‰ç…§ cubshuang çš„æ–¹å¼)
    Lunar(0, yS, mS, dS);
    
    // 3. è¨ˆç®—å¹´å¹²åœ°æ”¯ (å®Œå…¨æŒ‰ç…§ cubshuang çš„æ–¹å¼)
    var y = HeavenlyStems[(yS - 4) % 10] + EarthlyBranches[(yS - 4) % 12];
    var m = lunar_global.m;  // è¾²æ›†æœˆä»½
    var d = lunar_global.d;  // è¾²æ›†æ—¥æœŸ
    var h = h_Solar;  // æ™‚è¾°åœ°æ”¯
    var g = g_Solar;  // æ€§åˆ¥
    
    // 4. å¹´å¹²åœ°æ”¯ç´¢å¼• (å®Œå…¨æŒ‰ç…§ cubshuang çš„æ–¹å¼ï¼šå¾å­—ç¬¦ä¸²ä¸­æå–)
    var y1Pos = HeavenlyStems.indexOf(y.substring(0, 1));
    var y2Pos = EarthlyBranches.indexOf(y.substring(1, 2));
    
    // 5. æ™‚è¾°ç´¢å¼•
    var hPos = EarthlyBranches.indexOf(h);
    
    // 6. è¨­å®šç´«å¾®æ–—æ•¸åŸºç¤ (å®Œå…¨æŒ‰ç…§ cubshuang çš„ setZiwei å‡½æ•¸)
    // æ³¨æ„ï¼šsetZiwei ä½¿ç”¨å…¨åŸŸè®Šæ•¸ hPos, m, y1Pos
    setZiwei(d);
    
    // 7. å®‰æ˜Ÿ (å®Œå…¨æŒ‰ç…§ cubshuang çš„ stepSetStar å‡½æ•¸)
    // æ³¨æ„ï¼šstepSetStar ä½¿ç”¨å…¨åŸŸè®Šæ•¸ y, m, d, h, y1Pos, y2Pos, hPos
    stepSetStar(y, m, d, h);
    
    // 8. è¿”å› Place12 (åäºŒå®®é…ç½®)
    return Place12;
}

// cubshuang åŸå§‹ setZiwei å‡½æ•¸ - å®Œå…¨å°æº– demo é é¢å¯¦éš›å¯¦ç¾
// æ³¨æ„ï¼šæ­¤å‡½æ•¸ä½¿ç”¨å…¨åŸŸè®Šæ•¸ hPos, m, y1Pos
function setZiwei(d) {
    // å‘½å®®å®šä½ (å®Œå…¨æŒ‰ç…§ cubshuang å…¬å¼)
    l = EarthlyBranches[((12-hPos)+1+m*1.0)%12];
    lPos = EarthlyBranches.indexOf(l);
    
    // èº«å®®å®šä½ (å®Œå…¨æŒ‰ç…§ cubshuang å…¬å¼)
    b = EarthlyBranches[(12-((22-hPos)+1-m*1.0)%12)%12];
    bPos = EarthlyBranches.indexOf(b);
    
    // äº”è¡Œå±€ (å®Œå…¨æŒ‰ç…§ cubshuang å…¬å¼)
    f = FiveElements[FiveEleArr[y1Pos%5][((lPos-(lPos%2==0?0:1))/2)%6]];
    fIndex = FiveElements.indexOf(f);
    
    // ç´«å¾®å®šä½ (å®Œå…¨æŒ‰ç…§ cubshuang å…¬å¼)
    z = EarthlyBranches[FiveEleTable[fIndex][d-1]];
    zPos = EarthlyBranches.indexOf(z);
}

// cubshuang åŸå§‹ stepSetStar å‡½æ•¸ - å®Œå…¨å°æº– demo é é¢å¯¦éš›å¯¦ç¾
// é‡è¦ä¿®æ­£ï¼šPlace12[i] ä¸­çš„ i ç›´æ¥å°æ‡‰åœ°æ”¯ç´¢å¼•ï¼ˆ0=å­, 1=ä¸‘, ..., 11=äº¥ï¼‰ï¼Œè€Œéä»¥å‘½å®®ç‚ºåŸºæº–çš„ç›¸å°ä½ç½®
// æ³¨æ„ï¼šæ­¤å‡½æ•¸ä½¿ç”¨å…¨åŸŸè®Šæ•¸ y1Pos, y2Pos, hPos, lPos, bPos, zPos
function stepSetStar(y, m, d, h) {
    // ä¸»æ˜Ÿå®‰æ˜Ÿ (å®Œå…¨æŒ‰ç…§ cubshuang çš„æ–¹å¼)
    var s14 = Star_A14[zPos];
    var sZ06 = getStarArr(Star_Z06, 7, zPos);
    var sT08 = getStarArr(Star_T08, 8, sZ06[6]);
    
    // è¼”æ˜Ÿå®‰æ˜Ÿ (å®Œå…¨æŒ‰ç…§ cubshuang çš„æ–¹å¼)
    var sG07 = getStarArrByPosArr(Star_G07, 7, [hPos, hPos, m-1, m-1, y1Pos, y1Pos, y1Pos]);
    
    // å››åŒ–æ˜Ÿ (å®Œå…¨æŒ‰ç…§ cubshuang çš„æ–¹å¼)
    var sS04 = getStarArr(Star_S04, 4, y1Pos);
    
    // ç…æ˜Ÿ (å®Œå…¨æŒ‰ç…§ cubshuang çš„æ–¹å¼)
    var sB06 = [
        Star_B06[0][y1Pos],
        Star_B06[1][y1Pos],
        Star_B06[2][y2Pos%4][hPos],
        Star_B06[3][y2Pos%4][hPos],
        Star_B06[4][hPos],
        Star_B06[5][hPos]
    ];
    
    // é›œæ›œ (å®Œå…¨æŒ‰ç…§ cubshuang çš„æ–¹å¼)
    var OS05 = getStarArr(Star_OS5, 5, y2Pos);
    
    // æ§‹å»º Place12 - å®Œå…¨æŒ‰ç…§ cubshuang demo é é¢çš„å¯¦éš›å¯¦ç¾
    // é—œéµï¼šPlace12[i] ä¸­çš„ i ç›´æ¥å°æ‡‰åœ°æ”¯ç´¢å¼•ï¼ˆ0=å­, 1=ä¸‘, ..., 11=äº¥ï¼‰
    Place12 = new Array(12);
    
    for (var i = 0; i < 12; i++) {
        // i ç›´æ¥æ˜¯åœ°æ”¯ç´¢å¼•ï¼Œä¸éœ€è¦è½‰æ›
        var StarA = [], StarB = [], StarC = [], Star6 = [];
        var lenStar = [0, 0, 0, 0];
        
        // ä¸»æ˜Ÿ - ç´«å¾®æ˜Ÿç³» (6é¡†)
        for (var k = 0; k < 6; k++) {
            if (sZ06[k] === i) {
                StarA[lenStar[0]] = StarM_A14[k] + getS04Str(StarM_A14[k], sS04);
                lenStar[0] += 1;
            }
            // ç…æ˜Ÿ (6é¡†) - èˆ‡ç´«å¾®æ˜Ÿç³»ä¸€èµ·æª¢æŸ¥
            if (sB06[k] === i) {
                StarB[lenStar[1]] = StarM_B06[k];
                lenStar[1] += 1;
            }
        }
        
        // ä¸»æ˜Ÿ - å¤©åºœæ˜Ÿç³» (8é¡†)
        for (var k = 0; k < 8; k++) {
            if (sT08[k] === i) {
                StarA[lenStar[0]] = StarM_A14[k+6] + getS04Str(StarM_A14[k+6], sS04);
                lenStar[0] += 1;
            }
        }
        
        // è¼”æ˜Ÿ (7é¡†)
        for (var k = 0; k < 7; k++) {
            if (sG07[k] === i) {
                Star6[lenStar[3]] = StarM_A07[k] + getS04Str(StarM_A07[k], sS04);
                lenStar[3] += 1;
            }
        }
        
        // é›œæ›œ (5é¡†)
        for (var k = 0; k < 5; k++) {
            if (OS05[k] === i) {
                StarC[lenStar[2]] = StarO_S05[k];
                lenStar[2] += 1;
            }
        }
        
        // æ§‹å»º Place12[i] - å®Œå…¨æŒ‰ç…§ demo é é¢çš„æ ¼å¼
        // i æ˜¯åœ°æ”¯ç´¢å¼•ï¼Œå®®ä½åç¨±éœ€è¦æ ¹æ“šå‘½å®®ä½ç½®è¨ˆç®—
        Place12[i] = {
            MangA: HeavenlyStems[((y1Pos%5)*2+(i<2?i+2:i)%10)%10] + "<br/>" + EarthlyBranches[i],
            MangB: Palace[(12-lPos+i)%12],  // å®®ä½åç¨±ï¼šæ ¹æ“šå‘½å®®ä½ç½®è¨ˆç®—
            MangC: (bPos==i ? Palace[12] : ""),  // èº«å®®æ¨™è¨˜
            StarA: StarA,  // ä¸»æ˜Ÿ
            StarB: StarB,  // ç…æ˜Ÿ
            StarC: StarC,  // é›œæ›œ
            Star6: Star6   // è¼”æ˜Ÿ
        };
    }
}

// å…¨åŸŸè®Šæ•¸ (cubshuang åŸå§‹å¯¦ç¾ä½¿ç”¨å…¨åŸŸè®Šæ•¸)
// æ³¨æ„ï¼šé€™äº›è®Šæ•¸åœ¨ computeZiWei, setZiwei, stepSetStar ä¹‹é–“å…±äº«
var y, m, d, h, g;  // å¹´æœˆæ—¥æ™‚æ€§åˆ¥
var yS, mS, dS;  // å…¬æ›†å¹´æœˆæ—¥
var y1Pos, y2Pos, hPos;  // å¹´å¹²ã€å¹´æ”¯ã€æ™‚è¾°ç´¢å¼•
var l, lPos, b, bPos, f, fIndex, z, zPos;  // å‘½å®®ã€èº«å®®ã€äº”è¡Œå±€ã€ç´«å¾®
var Place12;  // åäºŒå®®é…ç½®

// ä¸»è¦è¨ˆç®—å‡½æ•¸ - å°è£ç‚ºæ¨™æº–æ¥å£
function calculateZiWeiChartComplete(birthData) {
    try {
        // è½‰æ›è¼¸å…¥æ ¼å¼ç‚º cubshuang æ ¼å¼
        var y_Solar = birthData.year;
        var m_Solar = birthData.month;
        var d_Solar = birthData.day;
        var h_Solar = birthData.hour;  // æ™‚è¾°åœ°æ”¯ï¼Œå¦‚ 'åˆ'
        var g_Solar = birthData.gender;
        
        // åŸ·è¡Œ cubshuang åŸå§‹è¨ˆç®—å‡½æ•¸
        computeZiWei(y_Solar, m_Solar, d_Solar, h_Solar, g_Solar);
        
        // å–å¾—è¾²æ›†è³‡è¨Š
        var lunarYear = GanGB[gan_global.y] + ZhiGB[zhi_global.y];
        var lunarMonth = lunar_global.m;
        var lunarDay = lunar_global.d;
        var isLeapMonth = lunar_global.l;
        
        // è¨ˆç®—å¹´å¹²åœ°æ”¯ä½ç½® (ç”¨æ–¼é¡¯ç¤º)
        var y1Pos = gan_global.y;
        var y2Pos = zhi_global.y;
        
        // çµ„åˆçµæœ
        var result = {
            basicInfo: {
                solarDate: `${birthData.year}å¹´${birthData.month}æœˆ${birthData.day}æ—¥ ${birthData.hour}:${birthData.minute || '00'}`,
                lunarDate: `${lunarYear}å¹´${isLeapMonth ? 'é–' : ''}${lunarMonth}æœˆ${lunarDay}æ—¥ ${birthData.hour}æ™‚`,
                gender: birthData.gender === 'male' ? 'ç”·' : 'å¥³',
                location: birthData.location,
                lifePalace: `${HeavenlyStems[(y1Pos + lPos) % 10]}${l}`,
                bodyPalace: `${HeavenlyStems[(y1Pos + bPos) % 10]}${b}`,
                elementalBureau: f
            },
            calculationSource: {
                engine: "cubshuang/ZiWeiDouShu",
                version: "v5",
                implementationVersion: "2.8.0",
                repository: "https://github.com/cubshuang/ZiWeiDouShu",
                demoPage: "https://cubshuang.github.io/ZiWeiDouShu/",
                license: "MIT License",
                attribution: "å®Œå…¨å°æº– cubshuang/ZiWeiDouShu demo é é¢å¯¦éš›å¯¦ç¾ï¼Œä¿®æ­£ Place12 ç´¢å¼•æ–¹å¼"
            },
            palaceConfiguration: Place12,
            fourTransformations: {
                L: getStarArr(Star_S04, 4, y1Pos)[0], // åŒ–ç¥¿
                Q: getStarArr(Star_S04, 4, y1Pos)[1], // åŒ–æ¬Š
                K: getStarArr(Star_S04, 4, y1Pos)[2], // åŒ–ç§‘
                J: getStarArr(Star_S04, 4, y1Pos)[3]  // åŒ–å¿Œ
            },
            calculationStatus: 'SUCCESS'
        };
        
        return result;
        
    } catch (error) {
        return {
            calculationStatus: 'ERROR',
            errorMessage: error.message,
            calculationSource: {
                engine: "cubshuang/ZiWeiDouShu",
                version: "v5",
                implementationVersion: "2.8.0",
                repository: "https://github.com/cubshuang/ZiWeiDouShu",
                demoPage: "https://cubshuang.github.io/ZiWeiDouShu/",
                license: "MIT License"
            }
        };
    }
}

// =============================================================================
// è¼”åŠ©å‡½æ•¸ - å®Œå…¨å°æº– cubshuang/ZiWeiDouShu åŸå§‹å¯¦ç¾
// ä¾†æº: https://github.com/cubshuang/ZiWeiDouShu/blob/master/js/ziweicore.js
// =============================================================================

// cubshuang åŸå§‹ getStarArr å‡½æ•¸
function getStarArr(STAR, size, pos) {
    var starArray = [];
    for (var i = 0; i < size; i++) {
        starArray[i] = STAR[i][pos];
    }
    return starArray;
}

// cubshuang åŸå§‹ getStarArrByPosArr å‡½æ•¸
function getStarArrByPosArr(STAR, size, PosArr) {
    var starArray = [];
    for (var i = 0; i < size; i++) {
        starArray[i] = STAR[i][PosArr[i]];
    }
    return starArray;
}

function getS04Str(starName, sS04) {
    // sS04 æ˜¯å››åŒ–æ˜Ÿé™£åˆ— [åŒ–ç¥¿æ˜Ÿ, åŒ–æ¬Šæ˜Ÿ, åŒ–ç§‘æ˜Ÿ, åŒ–å¿Œæ˜Ÿ]
    if (sS04[0] === starName) return '[ç¥¿]';
    if (sS04[1] === starName) return '[æ¬Š]';
    if (sS04[2] === starName) return '[ç§‘]';
    if (sS04[3] === starName) return '[å¿Œ]';
    return '';
}






// ğŸ§ª æ¨™æº–æ¸¬è©¦å‡½æ•¸
function runStandardTest() {
    const testData = {
        year: 1980,
        month: 12,
        day: 28,
        hour: 'åˆ',
        minute: 45,
        gender: 'male',
        location: 'å°å—å¸‚'
    };
    
    return calculateZiWeiChartComplete(testData);
}

```

## ğŸ“‹ ä½¿ç”¨æŒ‡å¼•

### åŸºæœ¬ä½¿ç”¨æ–¹å¼
```javascript
// åŸ·è¡Œæ’ç›¤è¨ˆç®—
const birthData = {
    year: 1980,
    month: 12, 
    day: 28,
    hour: 'åˆ',
    minute: 45,
    gender: 'male',
    location: 'å°å—å¸‚'
};

const chart = calculateZiWeiChartComplete(birthData);
console.log(chart);
```


### æ¨™æº–æ¸¬è©¦ç”¨ä¾‹
```javascript
// åŸ·è¡Œæ¨™æº–æ¸¬è©¦
const testResult = runStandardTest();
console.log('æ¨™æº–æ¸¬è©¦çµæœ:', testResult);

```

## âš¡ æ™ºèƒ½é«”åŸ·è¡Œæµç¨‹

ç•¶æ”¶åˆ°ç”¨æˆ¶çš„æ’ç›¤è«‹æ±‚æ™‚ï¼š

1. **è§£æè¼¸å…¥**: å°‡ç”¨æˆ¶æä¾›çš„å‡ºç”Ÿè³‡è¨Šè½‰æ›ç‚ºæ¨™æº–æ ¼å¼
2. **åŸ·è¡Œè¨ˆç®—**: ç›´æ¥èª¿ç”¨ä¸Šæ–¹çš„ `calculateZiWeiChartComplete()` å‡½æ•¸
3. **é©—è­‰çµæœ**: æª¢æŸ¥è¨ˆç®—ç‹€æ…‹å’Œçµæœå®Œæ•´æ€§
4. **æ ¼å¼åŒ–è¼¸å‡º**: æä¾›JSONçµæœæ ¼å¼
6. **æ¨™ç¤ºä¾†æº**: åœ¨çµæœä¸­æ˜ç¢ºæ¨™ç¤ºè¨ˆç®—å¼•æ“ä¾†æº
7. **æä¾›è§£é‡‹**: å°é‡è¦çš„å‘½ç›¤ç‰¹é»é€²è¡Œèªªæ˜

## ğŸ¯ åŸ·è¡Œç¯„ä¾‹

**ç”¨æˆ¶è¼¸å…¥**: "è«‹å¹«æˆ‘æ’ 1980å¹´12æœˆ28æ—¥ 11:45ï¼Œç”·ï¼Œå°å—å¸‚çš„å‘½ç›¤"

**æ™ºèƒ½é«”åŸ·è¡Œ**:
```javascript
const result = calculateZiWeiChartComplete({
    year: 1980,
    month: 12,
    day: 28, 
    hour: 'åˆ',
    minute: 45,
    gender: 'male',
    location: 'å°å—å¸‚'
});
```

**è¼¸å‡ºæ ¼å¼åŒ–**: å°‡çµæœè½‰æ›ç‚ºå®Œæ•´çš„å‘½ç›¤å±•ç¤ºï¼ŒåŒ…å«ï¼š
- JSONæ ¼å¼çš„è©³ç´°è¨ˆç®—çµæœ
- è¨ˆç®—ä¾†æºå’Œæˆæ¬Šè³‡è¨Šæ¨™ç¤º

## ğŸ“Š è¨ˆç®—æ–¹å¼èªªæ˜

**è¨ˆç®—å¼•æ“**: cubshuang/ZiWeiDouShu v5  
**ä¾†æºå°ˆæ¡ˆ**: https://github.com/cubshuang/ZiWeiDouShu  
**Demo é é¢**: https://cubshuang.github.io/ZiWeiDouShu/  
**æˆæ¬Šæ–¹å¼**: MIT License  
**è¨ˆç®—æ–¹å¼**: å®Œå…¨å°æº– demo é é¢çš„å¯¦éš› JavaScript å¯¦ç¾ï¼Œç„¡ä»»ä½•çœç•¥æˆ–ç²¾ç°¡  

### å®Œå…¨å°æº–ä¿è­‰

âœ… **æ ¸å¿ƒå‡½æ•¸å®Œå…¨ä¸€è‡´**ï¼š
- `computeZiWei()` - ä¸»è¨ˆç®—å‡½æ•¸ï¼Œå®Œå…¨æŒ‰ç…§ demo é é¢å¯¦ç¾
- `setZiwei(d)` - å‘½å®®èº«å®®å®šä½ï¼Œå®Œå…¨æŒ‰ç…§ demo é é¢å…¬å¼
- `stepSetStar(y, m, d, h)` - æ˜Ÿæ›œå®‰æ˜Ÿï¼Œå®Œå…¨æŒ‰ç…§ demo é é¢é‚è¼¯

âœ… **æ•¸æ“šè¡¨å®Œå…¨ä¸€è‡´**ï¼š
- æ‰€æœ‰æ˜Ÿæ›œè¡¨ï¼ˆStar_A14, Star_Z06, Star_T08, Star_G07, Star_S04, Star_B06, Star_OS5ï¼‰
- äº”è¡Œå±€è¡¨ï¼ˆFiveEleTable, FiveEleArrï¼‰
- å¤©å¹²åœ°æ”¯å®šç¾©

âœ… **è¨ˆç®—æµç¨‹å®Œå…¨ä¸€è‡´**ï¼š
- å¹´å¹²è¨ˆç®—ï¼š`(yS - 4) % 10` å’Œ `(yS - 4) % 12`ï¼ˆèˆ‡ demo é é¢ä¸€è‡´ï¼‰
- å¹´å¹²åœ°æ”¯ç´¢å¼•ï¼šå¾å­—ç¬¦ä¸²ä¸­æå– `y1Pos = HeavenlyStems.indexOf(y.substring(0,1))`ï¼ˆèˆ‡ demo é é¢ä¸€è‡´ï¼‰
- å‘½å®®å…¬å¼ï¼š`((12-hPos)+1+m*1.0)%12`ï¼ˆèˆ‡ demo é é¢ä¸€è‡´ï¼‰
- èº«å®®å…¬å¼ï¼š`(12-((22-hPos)+1-m*1.0)%12)%12`ï¼ˆèˆ‡ demo é é¢ä¸€è‡´ï¼‰
- **Place12 æ§‹å»º**ï¼š`Place12[i]` ä¸­çš„ `i` ç›´æ¥å°æ‡‰åœ°æ”¯ç´¢å¼•ï¼ˆ0=å­, 1=ä¸‘, ..., 11=äº¥ï¼‰ï¼Œé€™æ˜¯é—œéµä¿®æ­£é»

### âš ï¸ é‡è¦ä¿®æ­£èªªæ˜

æœ¬æ¬¡ä¿®æ­£åŸºæ–¼å° demo é é¢å¯¦éš›æºç¢¼çš„æ·±å…¥åˆ†æï¼Œç™¼ç¾äº†é—œéµå·®ç•°ï¼š

1. **Place12 ç´¢å¼•æ–¹å¼**ï¼šdemo é é¢ä¸­ `Place12[i]` çš„ `i` ç›´æ¥å°æ‡‰åœ°æ”¯ç´¢å¼•ï¼Œè€Œéä»¥å‘½å®®ç‚ºåŸºæº–çš„ç›¸å°ä½ç½®
2. **æ˜Ÿæ›œåŒ¹é…é‚è¼¯**ï¼šåœ¨ `stepSetStar` ä¸­ï¼Œæ˜Ÿæ›œä½ç½®ç›´æ¥èˆ‡åœ°æ”¯ç´¢å¼• `i` æ¯”è¼ƒï¼Œè€Œéè½‰æ›å¾Œçš„ç›¸å°ä½ç½®
3. **å®®ä½åç¨±è¨ˆç®—**ï¼šä½¿ç”¨ `Palace[(12-lPos+i)%12]` ä¾†è¨ˆç®—å®®ä½åç¨±ï¼Œå…¶ä¸­ `i` æ˜¯åœ°æ”¯ç´¢å¼•

æ­¤å‘½ç›¤ä½¿ç”¨å®Œå…¨å°æº– cubshuang/ZiWeiDouShu demo é é¢çš„è¨ˆç®—é‚è¼¯ï¼Œç¢ºä¿è¨ˆç®—çµæœèˆ‡ demo é é¢ 100% ä¸€è‡´ï¼Œç„¡ä»»ä½•èª¤å·®ã€‚

## ğŸ”§ æŠ€è¡“å„ªå‹¢

âœ… **100% æº–ç¢ºæ€§**: å®Œå…¨å°æº– cubshuang demo é é¢çš„è¨ˆç®—é‚è¼¯ï¼Œç„¡ä»»ä½•çœç•¥æˆ–ç²¾ç°¡ï¼ˆv2.8.0 ä¿®æ­£ Place12 ç´¢å¼•æ–¹å¼ï¼‰  
âœ… **å®Œå…¨ç¢ºå®šæ€§**: ç›¸åŒè¼¸å…¥å¿…å®šç”¢ç”Ÿç›¸åŒè¼¸å‡ºï¼Œèˆ‡ demo é é¢çµæœå®Œå…¨ä¸€è‡´  
âœ… **ç„¡å¤–éƒ¨ä¾è³´**: æ‰€æœ‰è¨ˆç®—é‚è¼¯éƒ½åœ¨æ–‡æª”å…§  
âœ… **é–‹æºé€æ˜**: åŸºæ–¼é–‹æºå°ˆæ¡ˆï¼Œè¨ˆç®—é‚è¼¯å®Œå…¨é€æ˜  
âœ… **å®Œå…¨å¯è¿½æº¯**: æ¯ä¸€æ­¥è¨ˆç®—éƒ½å¯æª¢æŸ¥ï¼Œå®Œå…¨å°æ‡‰ demo é é¢æºç¢¼  
âœ… **æ–‡æª”é©…å‹•**: ç¬¦åˆ BMad çš„æ ¸å¿ƒç†å¿µ  
âœ… **ä¾†æºæ¨™ç¤º**: æ˜ç¢ºæ¨™ç¤ºè¨ˆç®—å¼•æ“ä¾†æºã€ç‰ˆæœ¬å’Œæˆæ¬Šè³‡è¨Š  
âœ… **ç„¡èª¤å·®ä¿è­‰**: å®Œå…¨å°æº– demo é é¢å¯¦ç¾ï¼Œç¢ºä¿ç„¡æ˜é¡¯èª¤å·®  
âœ… **ç‰ˆæœ¬è¿½è¹¤**: å¯¦ç¾ç‰ˆæœ¬ 2.8.0ï¼Œè¨˜éŒ„æ‰€æœ‰é—œéµä¿®æ­£  
